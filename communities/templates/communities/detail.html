{% extends 'base.html' %}
{% load django_bootstrap5 %}

{% block content %}
  <div class="container">
    <div>
      {{ community.title }}
    </div>
    <div>
      {{ community.content}}
    </div>
    <div>
      {{ community.community }}
    </div>
    <div>
      {{ community.created_at }}
      {{ community.updated_at }}
    </div>
    {{ community.image }}
    <div>
      {% if request.user.is_authenticated %}
        {% if request.user in community.like_users.all %}
          <i id="" data-community-id="{{ community.pk }}" class="bi bi-heart-fill like-btn"></i>
        {% else %}
          <i id="" data-community-id="{{ community.pk }}" class="bi bi-heart like-btn"></i>
        {% endif %}
      {% endif %}
      <span id="like-count">{{ community.like_users.count }}</span>
    </div>
  </div>
  {% for comment in comments %}
    <div>
      {{ comment.content }}
    </div>
    <div>{{ comment.created_at|date:"o-m-d" }}
      {{ comment.created_at|time:"H:i" }}</div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      const likeBtn = document.querySelector('.like-btn')
      likeBtn.addEventListener('click', function (event) {
        console.log(event.target.dataset)
        axios({method: 'get', url: `/communities/${event.target.dataset.communityId}/like/`}).then(response => {
          console.log(response)
          console.log(response.data)
          console.log(response.data.is_liked)
          if (response.data.is_liked === true) {
            event
              .target
              .classList
              .add('bi-heart-fill')
            event
              .target
              .classList
              .remove('bi-heart')
          } else {
            event
              .target
              .classList
              .add('bi-heart')
            event
              .target
              .classList
              .remove('bi-heart-fill')
          }
          const likeCount = document.querySelector('#like-count')
          likeCount.innerText = response.data.likeCount
        })
      })
    </script>
  {% endblock content %}
